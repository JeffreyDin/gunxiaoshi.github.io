<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Every failure is leading towards success.">
    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          Python之TensorFlow_Estimator - gunxiaoshi | Blog
        
    </title>

    <link rel="canonical" href="http://gunxiaoshi.me/article/Python/Python之TensorFlow_Estimator/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/article_header/article (4).png')
            /*post*/
        
    }
    
</style>

<header class="intro-header">
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Python" title="Python">Python</a>
                            
                              <a class="tag" href="/tags/#机器学习" title="机器学习">机器学习</a>
                            
                              <a class="tag" href="/tags/#TensorFlow" title="TensorFlow">TensorFlow</a>
                            
                        </div>
                        <h1>Python之TensorFlow_Estimator</h1>
                        <h2 class="subheading">机器学习，TensorFlow</h2>
                        <span class="meta">
                            Posted by gunxiaoshi on
                            2018-12-13
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">gunxiaoshi</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="预创建的-Estimator"><a href="#预创建的-Estimator" class="headerlink" title="预创建的 Estimator"></a>预创建的 Estimator</h1><p><em><strong>本文档介绍了 TensorFlow 编程环境，并展示了如何在 TensorFlow 中解决鸢尾花分类问题。</strong></em></p>
<h2 id="安装TensorFlow"><a href="#安装TensorFlow" class="headerlink" title="安装TensorFlow"></a>安装TensorFlow</h2><blockquote>
<p>TensorFlow在以下64位系统上经过测试和支持：</p>
<ul>
<li>Ubuntu 16.04或更高版本</li>
<li>Windows 7或更高版本</li>
<li>macOS 10.12.6（Sierra）或更高版本（无GPU支持）</li>
<li>Raspbian 9.0或更高版本</li>
<li><a href="https://tensorflow.google.cn/install/" target="_blank" rel="noopener">官方安装文档</a></li>
</ul>
</blockquote>
<h3 id="本人运行底层环境（Python2-3）"><a href="#本人运行底层环境（Python2-3）" class="headerlink" title="本人运行底层环境（Python2+3）"></a>本人运行底层环境（Python2+3）</h3><p><em>附安装教程</em><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line">&gt; 底层环境：</span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># cat /etc/*release*</span></span><br><span class="line">CentOS Linux release <span class="number">7.2</span><span class="number">.1511</span> (Core) </span><br><span class="line">Derived <span class="keyword">from</span> Red Hat Enterprise Linux <span class="number">7.2</span> (Source)</span><br><span class="line">NAME=<span class="string">"CentOS Linux"</span></span><br><span class="line">VERSION=<span class="string">"7 (Core)"</span></span><br><span class="line">ID=<span class="string">"centos"</span></span><br><span class="line">ID_LIKE=<span class="string">"rhel fedora"</span></span><br><span class="line">VERSION_ID=<span class="string">"7"</span></span><br><span class="line">PRETTY_NAME=<span class="string">"CentOS Linux 7 (Core)"</span></span><br><span class="line">ANSI_COLOR=<span class="string">"0;31"</span></span><br><span class="line">CPE_NAME=<span class="string">"cpe:/o:centos:centos:7"</span></span><br><span class="line">HOME_URL=<span class="string">"https://www.centos.org/"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://bugs.centos.org/"</span></span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=<span class="string">"CentOS-7"</span></span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=<span class="string">"7"</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT=<span class="string">"centos"</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=<span class="string">"7"</span></span><br><span class="line"></span><br><span class="line">CentOS Linux release <span class="number">7.2</span><span class="number">.1511</span> (Core) </span><br><span class="line">CentOS Linux release <span class="number">7.2</span><span class="number">.1511</span> (Core) </span><br><span class="line">&gt; 安装python3 + pip3</span><br><span class="line"><span class="number">1.</span>查看是否已经安装Python</span><br><span class="line">Centos7 默认安装了Python2<span class="number">.7</span><span class="number">.5</span> 因为一些命令要用它比如 yum 它使用的是 python2<span class="number">.7</span><span class="number">.5</span>.使用 python -V 命令查看一下是否安装 Python：</span><br><span class="line"><span class="comment"># python -V</span></span><br><span class="line">Python <span class="number">2.7</span><span class="number">.5</span></span><br><span class="line"></span><br><span class="line">然后查看一下 Python 可执行文件的位置：</span><br><span class="line"><span class="comment"># which python</span></span><br><span class="line">/usr/bin/python</span><br><span class="line"></span><br><span class="line">进入到 bin 目录：</span><br><span class="line"><span class="comment"># cd /usr/bin/</span></span><br><span class="line"><span class="comment"># ls -al python*</span></span><br><span class="line">lrwxrwxrwx. 1 root root   34 8月  25 08:18 python -&gt; python2</span><br><span class="line">lrwxrwxrwx. 1 root root    9 8月  19 21:32 python2 -&gt; python2.7</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">7136</span> <span class="number">11</span>月  <span class="number">6</span> <span class="number">2016</span> python2<span class="number">.7</span></span><br><span class="line"></span><br><span class="line">可以看到可执行文件 python 指向 python2 ，python2 又指向 python2<span class="number">.7</span> 也就是说 Python 命令执行的系统预装的 Python2<span class="number">.7</span>.要安装 Python 的其他版本先执行mv python python.bak 命令备份 python 文件。</span><br><span class="line"><span class="comment"># mv python python.bak</span></span><br><span class="line"><span class="comment"># ls -al /usr/bin/python*</span></span><br><span class="line">lrwxrwxrwx 1 root root    7 10月 15 14:35 /usr/bin/python.bak -&gt; python2</span><br><span class="line">lrwxrwxrwx 1 root root    9 10月 15 14:35 /usr/bin/python2 -&gt; python2.7</span><br><span class="line">-rwxr-xr-x <span class="number">1</span> root root <span class="number">7216</span> <span class="number">7</span>月  <span class="number">13</span> <span class="number">21</span>:<span class="number">07</span> /usr/bin/python2<span class="number">.7</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>修改 yum 配置文件</span><br><span class="line">因为yum使用CentOS7<span class="number">.3</span>默认安装的Python <span class="number">2.7</span><span class="number">.5</span>,因此替换为Python <span class="number">3.6</span><span class="number">.2</span>后无法正常工作.</span><br><span class="line"><span class="comment"># yum repolist</span></span><br><span class="line">File <span class="string">"/usr/bin/yum"</span>, line <span class="number">30</span></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt, e:</span><br><span class="line">                            ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line"></span><br><span class="line">因此修改yum配置文件,继续使用Python2<span class="number">.7</span><span class="number">.5</span>.</span><br><span class="line">更改yum脚本的python依赖</span><br><span class="line"><span class="comment"># cd /usr/bin</span></span><br><span class="line"><span class="comment"># ls -al yum*</span></span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root   <span class="number">801</span> <span class="number">11</span>月 <span class="number">15</span> <span class="number">2016</span> yum</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root  <span class="number">9429</span> <span class="number">11</span>月  <span class="number">6</span> <span class="number">2016</span> yum-builddep</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root  <span class="number">8582</span> <span class="number">11</span>月  <span class="number">6</span> <span class="number">2016</span> yum-config-manager</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root  <span class="number">7609</span> <span class="number">11</span>月  <span class="number">6</span> <span class="number">2016</span> yum-debug-dump</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root  <span class="number">7903</span> <span class="number">11</span>月  <span class="number">6</span> <span class="number">2016</span> yum-debug-restore</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">10999</span> <span class="number">11</span>月  <span class="number">6</span> <span class="number">2016</span> yumdownloader</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">11031</span> <span class="number">11</span>月  <span class="number">6</span> <span class="number">2016</span> yum-groups-manager</span><br><span class="line">使用vim更改以上文件头,把 <span class="comment">#!/usr/bin/python 改为 #!/usr/bin/python2</span></span><br><span class="line"></span><br><span class="line">修改gnome-tweak-tool配置文件</span><br><span class="line"><span class="comment"># vim /usr/bin/gnome-tweak-tool</span></span><br><span class="line">把文件头 <span class="comment">#!/usr/bin/python 改为 #!/usr/bin/python2</span></span><br><span class="line">  </span><br><span class="line">修改urlgrabber配置文件</span><br><span class="line"><span class="comment"># vim /usr/libexec/urlgrabber-ext-down</span></span><br><span class="line">把文件头 <span class="comment">#!/usr/bin/python 改为 #!/usr/bin/python2</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>编译环境准备</span><br><span class="line">安装开发套件用于编译 Python3<span class="number">.6</span><span class="number">.4</span> 源码</span><br><span class="line"><span class="comment"># yum groupinstall 'Development Tools'</span></span><br><span class="line"></span><br><span class="line">安装 python3<span class="number">.6</span><span class="number">.4</span> 可能会使用到的依赖</span><br><span class="line"><span class="comment"># yum install -y ncurses-libs zlib-devel mysql-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span></span><br><span class="line"></span><br><span class="line">yum -y groupinstall “Development tools”</span><br><span class="line">yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>安装 Python3<span class="number">.6</span><span class="number">.4</span></span><br><span class="line">执行wget 命令直接下载到当前文件夹：</span><br><span class="line"><span class="comment"># wget https://www.python.org/ftp/python/3.6.4/Python-3.6.4.tgz</span></span><br><span class="line"></span><br><span class="line">解压：</span><br><span class="line"><span class="comment"># mkdir /usr/local/python3/</span></span><br><span class="line"><span class="comment"># tar -zxvf Python-3.6.4.tgz  -C  /usr/src/</span></span><br><span class="line"></span><br><span class="line">进入到Python<span class="number">-3.6</span><span class="number">.4</span>文件夹下,编译源码</span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># cd /usr/src/Python-3.6.4/</span></span><br><span class="line">[root@CentOS1511 Python<span class="number">-3.6</span><span class="number">.4</span>]<span class="comment"># ./configure --prefix=/usr/local/python3/ --enable-optimizations</span></span><br><span class="line">--prefix选项是配置安装的路径，如果不配置该选项，安装后可执行文件默认放在/usr/local/bin，库文件默认放在/usr/local/lib，配置文件默认放在/usr/local/etc，其它的资源文件放在/usr/local/share，比较凌乱.</span><br><span class="line"></span><br><span class="line">如果配置--prefix，如：./configure --prefix=/usr/local/python3可以把所有资源文件放在/usr/local/python3的路径中，不会杂乱.用了--prefix选项的另一个好处是卸载软件或移植软件。</span><br><span class="line"></span><br><span class="line">当某个安装的软件不再需要时，只须简单的删除该安装目录,就可以把软件卸载得干干净净；移植软件只需拷贝整个目录到另外一个相同的操作系统机器即可.当然要卸载程序，也可以在原来的make目录下用一次make uninstall，但前提是make文件指定过uninstall.</span><br><span class="line"></span><br><span class="line">--enable-optimizations 是优化选项（LTO,PGO 等）加上这个 flag 编译后，</span><br><span class="line">性能有 <span class="number">10</span>% 左右的优化,但是这会明显的增加编译时间,老久了.</span><br><span class="line"></span><br><span class="line">./configure命令执行完毕之后创建一个文件 Makefile, 供下面的make命令使用,执行make install之后就会把程序安装到我们指定的文件夹中去.</span><br><span class="line"></span><br><span class="line">[root@CentOS1511 Python<span class="number">-3.6</span><span class="number">.4</span>]<span class="comment"># make</span></span><br><span class="line">[root@CentOS1511 Python<span class="number">-3.6</span><span class="number">.4</span>]<span class="comment"># make install</span></span><br><span class="line">安装完成之后进入到/usr/local/python3目录,可以看到Python的可执行文件目录bin等相关目录.</span><br><span class="line"><span class="comment"># cd /usr/local/python3</span></span><br><span class="line"><span class="comment"># ll</span></span><br><span class="line">总用量 <span class="number">4</span></span><br><span class="line">drwxr-xr-x. <span class="number">2</span> root root <span class="number">4096</span> <span class="number">8</span>月  <span class="number">25</span> <span class="number">08</span>:<span class="number">07</span> bin</span><br><span class="line">drwxr-xr-x. <span class="number">3</span> root root   <span class="number">24</span> <span class="number">8</span>月  <span class="number">25</span> <span class="number">08</span>:<span class="number">07</span> include</span><br><span class="line">drwxr-xr-x. <span class="number">4</span> root root   <span class="number">63</span> <span class="number">8</span>月  <span class="number">25</span> <span class="number">08</span>:<span class="number">07</span> lib</span><br><span class="line">drwxr-xr-x. <span class="number">3</span> root root   <span class="number">17</span> <span class="number">8</span>月  <span class="number">25</span> <span class="number">08</span>:<span class="number">07</span> share</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>修改软链接配置 Python3<span class="number">.6</span> 、pip3<span class="number">.6</span> 为系统默认</span><br><span class="line"><span class="comment"># ln -s /usr/local/python3/bin/python3.6 /usr/bin/python</span></span><br><span class="line"><span class="comment"># ln -s /usr/local/python3/bin/pip3.6 /usr/bin/pip</span></span><br><span class="line">ln: 无法创建符号链接<span class="string">"/usr/bin/pip"</span>: 文件已存在</span><br><span class="line">[root@CentOS1511 bin]<span class="comment"># cd /usr/bin/</span></span><br><span class="line">[root@CentOS1511 bin]<span class="comment"># ls -al pip*</span></span><br><span class="line">[root@CentOS1511 bin]<span class="comment"># mv pip pip.bak</span></span><br><span class="line">查看系统默认 Python、pip版本:</span><br><span class="line">&gt; 运行环境（python3 + pip3）：</span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># python2 -V</span></span><br><span class="line">Python <span class="number">2.7</span><span class="number">.5</span></span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># python -V</span></span><br><span class="line">Python <span class="number">3.6</span><span class="number">.4</span></span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># pip -V</span></span><br><span class="line">pip <span class="number">18.1</span> <span class="keyword">from</span> /usr/local/python3/lib/python3<span class="number">.6</span>/site-packages/pip (python <span class="number">3.6</span>)</span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># ls^Cusr/local/python3/</span></span><br><span class="line"></span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># ls -al /usr/bin/python*</span></span><br><span class="line">lrwxrwxrwx 1 root root   32 10月 21 15:42 /usr/bin/python -&gt; /usr/local/python3/bin/python3.6</span><br><span class="line">lrwxrwxrwx 1 root root    9 10月 15 14:35 /usr/bin/python2 -&gt; python2.7</span><br><span class="line">-rwxr-xr-x <span class="number">1</span> root root <span class="number">7216</span> <span class="number">7</span>月  <span class="number">13</span> <span class="number">21</span>:<span class="number">07</span> /usr/bin/python2<span class="number">.7</span></span><br><span class="line">lrwxrwxrwx 1 root root    7 10月 15 14:35 /usr/bin/python.bak -&gt; python2</span><br><span class="line"></span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># ls -al /usr/bin/pip*</span></span><br><span class="line">lrwxrwxrwx 1 root root  29 10月 21 15:42 /usr/bin/pip -&gt; /usr/local/python3/bin/pip3.6</span><br><span class="line">-rwxr-xr-x <span class="number">1</span> root root <span class="number">215</span> <span class="number">10</span>月 <span class="number">15</span> <span class="number">19</span>:<span class="number">36</span> /usr/bin/pip2</span><br><span class="line">-rwxr-xr-x <span class="number">1</span> root root <span class="number">215</span> <span class="number">10</span>月 <span class="number">15</span> <span class="number">19</span>:<span class="number">36</span> /usr/bin/pip2<span class="number">.7</span></span><br><span class="line">-rwxr-xr-x <span class="number">1</span> root root <span class="number">215</span> <span class="number">10</span>月 <span class="number">15</span> <span class="number">19</span>:<span class="number">36</span> /usr/bin/pip.bak</span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">&gt; 可忽略</span><br><span class="line">[root@CentOS1511 Tensorflow]<span class="comment"># vim ~/.bash_profile </span></span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># cat  ~/.bash_profile           </span></span><br><span class="line"><span class="comment"># .bash_profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the aliases and functions</span></span><br><span class="line"><span class="keyword">if</span> [ -f ~/.bashrc ]; then</span><br><span class="line">        . ~/.bashrc</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment"># User specific environment and startup programs</span></span><br><span class="line"></span><br><span class="line">PATH=$PATH:$HOME/bin:/usr/local/python3/bin</span><br><span class="line"></span><br><span class="line">export PATH</span><br><span class="line">[root@CentOS1511 Tensorflow]<span class="comment"># source ~/.bash_profile</span></span><br></pre></td></tr></table></figure></p>
<h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><blockquote>
<p>如果您是使用 virtualenv 或 Anaconda 安装的 TensorFlow，请激活 TensorFlow 环境。<br><a href="https://tensorflow.google.cn/install/" target="_blank" rel="noopener">安装Tensorflow</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS1511 ~]<span class="comment"># mkdir /Tensorflow</span></span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># cd /Tensorflow/</span></span><br><span class="line">&gt; 安装Tensorflow：</span><br><span class="line">[root@CentOS1511 Tensorflow]<span class="comment"># pip install tensorflow</span></span><br><span class="line">&gt; 安装或升级 Pandas：</span><br><span class="line">[root@CentOS1511 ~]<span class="comment"># pip install pandas</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="获取示例代码"><a href="#获取示例代码" class="headerlink" title="获取示例代码"></a>获取示例代码</h3><p>按照下列步骤获取我们将要使用的示例代码：</p>
<p>通过输入以下命令从 GitHub 克隆 TensorFlow 模型代码库：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS1511 Tensorflow]<span class="comment"># git clone https://github.com/tensorflow/models</span></span><br></pre></td></tr></table></figure></p>
<p>将此分支内的目录更改为包含本文档中所用示例的位置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS1511 Tensorflow]<span class="comment"># cd /Tensorflow/models/samples/core/get_started/</span></span><br></pre></td></tr></table></figure></p>
<h2 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS1511 get_started]<span class="comment"># python premade_estimator.py</span></span><br></pre></td></tr></table></figure>
<p>该程序应该会输出训练日志，然后对测试集进行一些预测。例如，以下输出的第一行显示该模型认为测试集中的第一个样本是山鸢尾的可能性为 99.6％。由于测试集中的第一个样本确实是山鸢尾，因此该模型预测得还比较准确。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">Prediction <span class="keyword">is</span> <span class="string">"Setosa"</span> (<span class="number">99.9</span>%), expected <span class="string">"Setosa"</span></span><br><span class="line"></span><br><span class="line">Prediction <span class="keyword">is</span> <span class="string">"Versicolor"</span> (<span class="number">98.6</span>%), expected <span class="string">"Versicolor"</span></span><br><span class="line"></span><br><span class="line">Prediction <span class="keyword">is</span> <span class="string">"Virginica"</span> (<span class="number">98.9</span>%), expected <span class="string">"Virginica"</span></span><br></pre></td></tr></table></figure></p>
<p>如果程序生成错误（而不是答案），请思考下列问题：</p>
<ul>
<li>是否正确安装了 TensorFlow？</li>
<li>使用的 TensorFlow 版本是否正确？</li>
<li>是否激活了 TensorFlow 所在的安装环境？（此问题仅与某些安装机制有关。）</li>
</ul>
<h1 id="编程堆栈"><a href="#编程堆栈" class="headerlink" title="编程堆栈"></a>编程堆栈</h1><p>在详细了解程序本身之前，先来了解编程环境。如下图所示，TensorFlow 提供一个包含多个 API 层的编程堆栈：<br><img src="https://tensorflow.google.cn/images/tensorflow_programming_environment.png" alt="API 层的编程堆栈"></p>
<p>强烈建议使用下列 API 编写 TensorFlow 程序：</p>
<p><a href="https://tensorflow.google.cn/guide/estimators" target="_blank" rel="noopener">Estimator</a>：代表一个完整的模型。Estimator API 提供一些方法来训练模型、判断模型的准确率并生成预测。<br><a href="https://tensorflow.google.cn/guide/datasets_for_estimators" target="_blank" rel="noopener">Estimator的数据集</a>：构建数据输入管道。Dataset API 提供一些方法来加载和操作数据，并将数据馈送到模型中。Dataset API 与 Estimator API 合作无间。</p>
<h1 id="对鸢尾花进行分类：概览"><a href="#对鸢尾花进行分类：概览" class="headerlink" title="对鸢尾花进行分类：概览"></a>对鸢尾花进行分类：概览</h1><p>示例程序构建并测试了一个模型，此模型根据鸢尾花的花萼和花瓣大小将其分为三种不同的品种。</p>
<p>三个鸢尾花品种的花瓣几何对比：山鸢尾、维吉尼亚鸢尾和变色鸢尾<br><img src="/img/article/1山鸢尾.png" alt="1鸢尾"><br>从左到右：山鸢尾（提供者：Radomil，依据 CC BY-SA 3.0 使用）、变色鸢尾（提供者：Dlanglois，依据 CC BY-SA 3.0 使用）和维吉尼亚鸢尾（提供者：Frank Mayfield，依据 CC BY-SA 2.0 使用）。</p>
<h2 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h2><p>鸢尾花数据集包含四个特征和一个标签。这四个特征确定了单株鸢尾花的下列植物学特征：</p>
<ul>
<li>花萼长度</li>
<li>花萼宽度</li>
<li>花瓣长度</li>
<li>花瓣宽度<br>模型会将这些特征表示为 float32 数值数据。</li>
</ul>
<p>该标签确定了鸢尾花品种，品种必须是下列任意一种：</p>
<ul>
<li>山鸢尾 (0)</li>
<li>变色鸢尾 (1)</li>
<li>维吉尼亚鸢尾 (2)<br>模型会将该标签表示为 int32 分类数据。</li>
</ul>
<p>下表显示了数据集中的三个样本：</p>
<table>
<thead>
<tr>
<th>花萼长度</th>
<th>花萼宽度</th>
<th>花瓣长度</th>
<th>花瓣宽度</th>
<th>品种（标签）</th>
</tr>
</thead>
<tbody>
<tr>
<td>5.1</td>
<td>3.3</td>
<td>1.7</td>
<td>0.5</td>
<td>0（山鸢尾）</td>
</tr>
<tr>
<td>5.0</td>
<td>2.3</td>
<td>3.3</td>
<td>1.0</td>
<td>1（变色鸢尾）</td>
</tr>
<tr>
<td>6.4</td>
<td>2.8</td>
<td>5.6</td>
<td>2.2</td>
<td>2（维吉尼亚鸢尾）</td>
</tr>
</tbody>
</table>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><p>该程序会训练一个具有以下拓扑结构的深度神经网络分类器模型：</p>
<ul>
<li>2 个隐藏层。</li>
<li>每个隐藏层包含 10 个节点。<br>下图展示了特征、隐藏层和预测（并未显示隐藏层中的所有节点）：<br><img src="/img/article/2.png" alt="2"><br>网络架构图：输入、2 个隐藏层和输出<h2 id="推理"><a href="#推理" class="headerlink" title="推理"></a>推理</h2>在无标签样本上运行经过训练的模型会产生三个预测，即相应鸢尾花属于指定品种的可能性。这些输出预测的总和是 1.0。例如，对无标签样本的预测可能如下所示：</li>
<li>0.03（山鸢尾）</li>
<li>0.95（变色鸢尾）</li>
<li>0.02（维吉尼亚鸢尾）<br>上面的预测表示指定无标签样本是变色鸢尾的概率为 95％。</li>
</ul>
<h1 id="采用-Estimator-进行编程的概览"><a href="#采用-Estimator-进行编程的概览" class="headerlink" title="采用 Estimator 进行编程的概览"></a>采用 Estimator 进行编程的概览</h1><p>Estimator 是 TensorFlow 对完整模型的高级表示。它会处理初始化、日志记录、保存和恢复等细节部分，并具有很多其他功能，以便可以专注于模型。有关更多详情，请参阅 Estimator。</p>
<p>Estimator 是从 tf.estimator.Estimator 衍生而来的任何类。TensorFlow 提供一组预创建的 Estimator（例如 LinearRegressor）来实现常见的机器学习算法。除此之外，可以编写自定义 Estimator。我们建议在刚开始使用 TensorFlow 时使用预创建的 Estimator。</p>
<p>要根据预创建的 Estimator 编写 TensorFlow 程序，必须执行下列任务：</p>
<ul>
<li>创建一个或多个输入函数。</li>
<li>定义模型的特征列。</li>
<li>实例化 Estimator，指定特征列和各种超参数。</li>
<li>在 Estimator 对象上调用一个或多个方法，传递适当的输入函数作为数据的来源。</li>
<li>来看看如何针对鸢尾花分类实施这些任务。</li>
</ul>
<h1 id="创建输入函数"><a href="#创建输入函数" class="headerlink" title="创建输入函数"></a>创建输入函数</h1><p>必须创建输入函数来提供用于训练、评估和预测的数据。</p>
<p>输入函数是返回 tf.data.Dataset 对象的函数，此对象会输出下列含有两个元素的元组：</p>
<p>features - Python 字典，其中：<br>每个键都是特征的名称。<br>每个值都是包含此特征所有值的数组。<br>label - 包含每个样本的标签值的数组。<br>为了向展示输入函数的格式，请查看下面这个简单的实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">input_evaluation_set</span><span class="params">()</span>:</span></span><br><span class="line">    features = &#123;<span class="string">'SepalLength'</span>: np.array([<span class="number">6.4</span>, <span class="number">5.0</span>]),</span><br><span class="line">                <span class="string">'SepalWidth'</span>:  np.array([<span class="number">2.8</span>, <span class="number">2.3</span>]),</span><br><span class="line">                <span class="string">'PetalLength'</span>: np.array([<span class="number">5.6</span>, <span class="number">3.3</span>]),</span><br><span class="line">                <span class="string">'PetalWidth'</span>:  np.array([<span class="number">2.2</span>, <span class="number">1.0</span>])&#125;</span><br><span class="line">    labels = np.array([<span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> features, labels</span><br></pre></td></tr></table></figure>
<p>输入函数可以以您需要的任何方式生成 features 字典和 label 列表。不过，我们建议使用 TensorFlow 的 Dataset API，它可以解析各种数据。概括来讲，Dataset API 包含下列类：<br><img src="/img/article/3.png" alt="3"><br>各个类如下所示：</p>
<ul>
<li>Dataset - 包含创建和转换数据集的方法的基类。您还可以通过该类从内存中的数据或 Python 生成器初始化数据集。</li>
<li>TextLineDataset - 从文本文件中读取行。</li>
<li>TFRecordDataset - 从 TFRecord 文件中读取记录。</li>
<li>FixedLengthRecordDataset - 从二进制文件中读取具有固定大小的记录。</li>
<li>Iterator - 提供一次访问一个数据集元素的方法。</li>
</ul>
<p>Dataset API 可以处理很多常见情况。例如，使用 Dataset API，可以轻松地从大量并行文件中读取记录，并将它们合并为单个数据流。</p>
<p>为了简化此示例，使用 Pandas 加载数据，并利用此内存中的数据构建输入管道。</p>
<p>以下是用于在此程序中进行训练的输入函数（位于 iris_data.py 中）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_input_fn</span><span class="params">(features, labels, batch_size)</span>:</span></span><br><span class="line">    <span class="string">"""An input function for training"""</span></span><br><span class="line">    <span class="comment"># Convert the inputs to a Dataset.</span></span><br><span class="line">    dataset = tf.data.Dataset.from_tensor_slices((dict(features), labels))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Shuffle, repeat, and batch the examples.</span></span><br><span class="line">    <span class="keyword">return</span> dataset.shuffle(<span class="number">1000</span>).repeat().batch(batch_size)</span><br></pre></td></tr></table></figure>
<h1 id="定义特征列"><a href="#定义特征列" class="headerlink" title="定义特征列"></a>定义特征列</h1><p>特征列是一个对象，用于说明模型应该如何使用特征字典中的原始输入数据。在构建 Estimator 模型时，您会向其传递一个特征列的列表，其中包含您希望模型使用的每个特征。tf.feature_column 模块提供很多用于在模型中表示数据的选项。</p>
<p>对于鸢尾花问题，4 个原始特征是数值，因此我们会构建一个特征列的列表，以告知 Estimator 模型将这 4 个特征都表示为 32 位浮点值。因此，创建特征列的代码如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Feature columns describe how to use the input.</span></span><br><span class="line">my_feature_columns = []</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> train_x.keys():</span><br><span class="line">    my_feature_columns.append(tf.feature_column.numeric_column(key=key))</span><br></pre></td></tr></table></figure>
<p>特征列可能比上述示例复杂得多。我们将在入门指南的后面部分详细介绍特征列。</p>
<p>我们已经介绍了希望模型如何表示原始特征，现在可以构建 Estimator 了。</p>
<h1 id="实例化-Estimator"><a href="#实例化-Estimator" class="headerlink" title="实例化 Estimator"></a>实例化 Estimator</h1><p>鸢尾花问题是一个经典的分类问题。幸运的是，TensorFlow 提供了几个预创建的分类器 Estimator，其中包括：</p>
<ul>
<li>tf.estimator.DNNClassifier：适用于执行多类别分类的深度模型。</li>
<li>tf.estimator.DNNLinearCombinedClassifier：适用于宽度和深度模型。</li>
<li>tf.estimator.LinearClassifier：适用于基于线性模型的分类器。</li>
</ul>
<p>对于鸢尾花问题，tf.estimator.DNNClassifier 似乎是最好的选择。我们将如下所示地实例化此Estimator：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build a DNN with 2 hidden layers and 10 nodes in each hidden layer.</span></span><br><span class="line">classifier = tf.estimator.DNNClassifier(</span><br><span class="line">    feature_columns=my_feature_columns,</span><br><span class="line">    <span class="comment"># Two hidden layers of 10 nodes each.</span></span><br><span class="line">    hidden_units=[<span class="number">10</span>, <span class="number">10</span>],</span><br><span class="line">    <span class="comment"># The model must choose between 3 classes.</span></span><br><span class="line">    n_classes=<span class="number">3</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="训练、评估和预测"><a href="#训练、评估和预测" class="headerlink" title="训练、评估和预测"></a>训练、评估和预测</h1><p>我们已经有一个 Estimator 对象，现在可以调用方法来执行下列操作</p>
<ul>
<li>训练模型。</li>
<li>评估经过训练的模型。</li>
<li>使用经过训练的模型进行预测。<h2 id="训练模型"><a href="#训练模型" class="headerlink" title="训练模型"></a>训练模型</h2>通过调用 Estimator 的 train 方法训练模型，如下所示：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Train the Model.</span></span><br><span class="line">classifier.train(</span><br><span class="line">    input_fn=<span class="keyword">lambda</span>:iris_data.train_input_fn(train_x, train_y, args.batch_size),</span><br><span class="line">    steps=args.train_steps)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>我们将 input_fn 调用封装在 lambda 中以获取参数，同时提供一个不采用任何参数的输入函数，正如 Estimator 预计的那样。steps 参数告知方法在训练多步后停止训练。</p>
<h2 id="评估经过训练的模型"><a href="#评估经过训练的模型" class="headerlink" title="评估经过训练的模型"></a>评估经过训练的模型</h2><p>模型已经过训练，现在我们可以获取一些关于其效果的统计信息。以下代码块会评估经过训练的模型对测试数据进行预测的准确率：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Evaluate the model.</span></span><br><span class="line">eval_result = classifier.evaluate(</span><br><span class="line">    input_fn=<span class="keyword">lambda</span>:iris_data.eval_input_fn(test_x, test_y, args.batch_size))</span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nTest set accuracy: &#123;accuracy:0.3f&#125;\n'</span>.format(**eval_result))</span><br></pre></td></tr></table></figure></p>
<p>与我们对 train 方法的调用不同，我们没有传递 steps 参数来进行评估。我们的 eval_input_fn 只生成一个周期的数据。</p>
<p>运行此代码会生成以下输出（或类似输出）：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Test set accuracy: <span class="number">0.967</span></span><br></pre></td></tr></table></figure></p>
<h2 id="利用经过训练的模型进行预测（推理）"><a href="#利用经过训练的模型进行预测（推理）" class="headerlink" title="利用经过训练的模型进行预测（推理）"></a>利用经过训练的模型进行预测（推理）</h2><p>我们已经有一个经过训练的模型，可以生成准确的评估结果。我们现在可以使用经过训练的模型，根据一些无标签测量结果预测鸢尾花的品种。与训练和评估一样，我们使用单个函数调用进行预测：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate predictions from the model</span></span><br><span class="line">expected = [<span class="string">'Setosa'</span>, <span class="string">'Versicolor'</span>, <span class="string">'Virginica'</span>]</span><br><span class="line">predict_x = &#123;</span><br><span class="line">    <span class="string">'SepalLength'</span>: [<span class="number">5.1</span>, <span class="number">5.9</span>, <span class="number">6.9</span>],</span><br><span class="line">    <span class="string">'SepalWidth'</span>: [<span class="number">3.3</span>, <span class="number">3.0</span>, <span class="number">3.1</span>],</span><br><span class="line">    <span class="string">'PetalLength'</span>: [<span class="number">1.7</span>, <span class="number">4.2</span>, <span class="number">5.4</span>],</span><br><span class="line">    <span class="string">'PetalWidth'</span>: [<span class="number">0.5</span>, <span class="number">1.5</span>, <span class="number">2.1</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">predictions = classifier.predict(</span><br><span class="line">    input_fn=<span class="keyword">lambda</span>:iris_data.eval_input_fn(predict_x, batch_size=args.batch_size))</span><br></pre></td></tr></table></figure></p>
<p>predict 方法返回一个 Python 可迭代对象，为每个样本生成一个预测结果字典。以下代码输出了一些预测及其概率：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">template = (<span class="string">'\nPrediction is "&#123;&#125;" (&#123;:.1f&#125;%), expected "&#123;&#125;"'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pred_dict, expec <span class="keyword">in</span> zip(predictions, expected):</span><br><span class="line">    class_id = pred_dict[<span class="string">'class_ids'</span>][<span class="number">0</span>]</span><br><span class="line">    probability = pred_dict[<span class="string">'probabilities'</span>][class_id]</span><br><span class="line"></span><br><span class="line">    print(template.format(iris_data.SPECIES[class_id], <span class="number">100</span> * probability, expec))</span><br></pre></td></tr></table></figure></p>
<p>运行上面的代码会生成以下输出：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Prediction <span class="keyword">is</span> <span class="string">"Setosa"</span> (<span class="number">99.6</span>%), expected <span class="string">"Setosa"</span></span><br><span class="line"></span><br><span class="line">Prediction <span class="keyword">is</span> <span class="string">"Versicolor"</span> (<span class="number">99.8</span>%), expected <span class="string">"Versicolor"</span></span><br><span class="line"></span><br><span class="line">Prediction <span class="keyword">is</span> <span class="string">"Virginica"</span> (<span class="number">97.9</span>%), expected <span class="string">"Virginica"</span></span><br></pre></td></tr></table></figure></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>使用预创建的 Estimator 可以快速高效地创建标准模型。<br>您已经开始编写 TensorFlow 程序，现在请查看以下资料：</p>
<ul>
<li>检查点：了解如何保存和恢复模型。</li>
<li>Estimator 的数据集：详细了解如何将数据导入模型中。</li>
<li>创建自定义 Estimator：了解如何编写针对特定问题进行自定义的 Estimator。</li>
</ul>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/article/TEST/Markdown/" data-toggle="tooltip" data-placement="top" title="Markdown语法">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/article/AWS/AWS之Qwiklab4/" data-toggle="tooltip" data-placement="top" title="AWS之Qwiklab4">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#预创建的-Estimator"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">预创建的 Estimator</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#安装TensorFlow"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">安装TensorFlow</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#本人运行底层环境（Python2-3）"><span class="toc-nav-number">1.1.1.</span> <span class="toc-nav-text">本人运行底层环境（Python2+3）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#前提条件"><span class="toc-nav-number">1.1.2.</span> <span class="toc-nav-text">前提条件</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#获取示例代码"><span class="toc-nav-number">1.1.3.</span> <span class="toc-nav-text">获取示例代码</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#运行程序"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">运行程序</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#编程堆栈"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">编程堆栈</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#对鸢尾花进行分类：概览"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">对鸢尾花进行分类：概览</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#数据集"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">数据集</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#算法"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">算法</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#推理"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">推理</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#采用-Estimator-进行编程的概览"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">采用 Estimator 进行编程的概览</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#创建输入函数"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">创建输入函数</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#定义特征列"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">定义特征列</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#实例化-Estimator"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">实例化 Estimator</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#训练、评估和预测"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">训练、评估和预测</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#训练模型"><span class="toc-nav-number">8.1.</span> <span class="toc-nav-text">训练模型</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#评估经过训练的模型"><span class="toc-nav-number">8.2.</span> <span class="toc-nav-text">评估经过训练的模型</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#利用经过训练的模型进行预测（推理）"><span class="toc-nav-number">8.3.</span> <span class="toc-nav-text">利用经过训练的模型进行预测（推理）</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#总结"><span class="toc-nav-number">9.</span> <span class="toc-nav-text">总结</span></a></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Python" title="Python">Python</a>
                        
                          <a class="tag" href="/tags/#机器学习" title="机器学习">机器学习</a>
                        
                          <a class="tag" href="/tags/#TensorFlow" title="TensorFlow">TensorFlow</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://docs.amazonaws.cn/index.html#lang/zh_cn" target="_blank">AWS</a></li>
                    
                        <li><a href="https://www.cnblogs.com/gunxiaoshi/" target="_blank">博客园</a></li>
                    
                        <li><a href="https://www.jianshu.com/u/abe128c859a6" target="_blank">简书</a></li>
                    
                        <li><a href="" target="_blank">DockOne</a></li>
                    
                        <li><a href="" target="_blank">阿里云栖社区 </a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/gunxiaoshi">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/gunxiaoshi">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://github.com/gunxiaoshi">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/gunxiaoshi">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; gunxiaoshi 2019 
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    change by <a href="http://www.gunxiaoshi.me">gunxiaoshi</a> | 
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://gunxiaoshi.me/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="http://gunxiaoshi.me/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
